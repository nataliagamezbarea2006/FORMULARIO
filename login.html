<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i|Roboto+Mono:300,400,700|Roboto+Slab:300,400,700" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/home.css">
  <link rel="stylesheet" href="style/registro.css">
  <title>Inicio de sesión</title>
  <style>
    /* Establece un ancho fijo para el formulario */
    #formulario-pago {
      max-width: 400px; /* Cambia el valor según tu preferencia */
      margin: 0 auto; /* Centra el formulario */
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="row justify-content-center align-items-center" style="height: 100vh;">
      <div class="col">
        <form id="formulario-pago" method="post">
          <h1>Inicio de sesión</h1>
          <div class="mb-3 mt-5">
            <label for="inputUsuario" class="form-label">Usuario</label>
            <input type="text" class="form-control" id="inputUsuario" name="Usuario" aria-describedby="emailHelp">
          </div>
          <div class="mb-3">
            <label for="inputContraseña" class="form-label">Contraseña</label>
            <input type="password" class="form-control" id="inputContraseña" name="Contraseña">
            <div id="emailHelp" class="form-text mt-3">Recuperar contraseña</div>
          </div>
          <button type="submit" class="btn btn-primary">Realizar Registro</button>
        </form>
      </div>
    </div>
  </div>
  
  <script>
    document.getElementById('formulario-pago').addEventListener('submit', async function(event) {
      event.preventDefault(); // Evita que el formulario se envíe y la página se recargue
      
      const usernameInput = document.getElementById('inputUsuario').value;
      const passwordInput = document.getElementById('inputContraseña').value;

      // URL pública del nuevo archivo CSV de Google Sheets
      const url = 'https://docs.google.com/spreadsheets/d/1XsqQcQt7kxX1yg66t04_bXboBYqAMp5g7BrN-vk46Cg/edit?usp=sharing';

      try {
        const response = await fetch(url);
        const data = await response.text();

        if (data) {
          // Convertir el CSV a matriz de filas y columnas
          const filas = data.split('\n').map(row => row.split(','));

          let credencialesCorrectas = false;

          // Iterar sobre cada fila para obtener usuario y contraseña
          for (let i = 0; i < filas.length; i++) {
            const fila = filas[i];
            const usuario = fila[0]; // El nombre de usuario está en la primera columna (0-index)
            const contraseña = fila[1]; // La contraseña está en la segunda columna (0-index)

            if (usuario === usernameInput && contraseña === passwordInput) {
              credencialesCorrectas = true;
              break;
            }
          }

          if (credencialesCorrectas) {
            console.log('¡Acceso concedido! Redirigiendo...');
            window.location.href = 'index.html';
          } else {
            console.log('Credenciales incorrectas. Inténtalo de nuevo.');
          }
        }
      } catch (error) {
        console.error('Error al obtener los datos:', error);
      }
    });
  </script>
  
  <!-- Scripts y enlaces a JavaScript -->
  <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
  <script src="assets/js/material.min.js"></script>
  <script src="js/datosintroducidos.js"></script>
  <script src="js/validar.js"> </script>
</body>
</html>
